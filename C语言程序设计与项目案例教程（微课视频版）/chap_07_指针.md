## 指针与指针变量

- 指针的概念
  - 内存地址
  - 变量名
  - 变量地址：系统分配给变量的内存单元的起始地址。
  - 变量值：变量的地址所对应的内存单元中所存放的数值或内容。
  - 变量的访问形式
    - 直接访问：要访问变量必须通过地址找到该变量的存储单元。
      - 用变量名对变量的访问属于“直接访问”。编译后，变量名和变量地址之间建立了对应关系，对变量名的访问，系统会自动转换为**利用地址对变量的访问**。
    - 间接访问：把一个变量的地址放在另一个变量中，利用这个特殊的变量进行访问。
      - 存放地址的变量是一种特殊变量，它**只能用来存放地址**，不能用来存放其他类型的数据，需要专门加以定义。
  - 两种访问方式的比较：“指针”是为形象地表示访问变量时的指引关系。通常说的指针时表示指针变量，实际上它只是存放了一个变量的地址。
  
- 指针变量
  - 定义：存放地址的变量称为指针变量，指针变量是指针类型。
  
    ```c
    基类型 *指针变量名
    /*
    *	基类型：该指针变量所指向的变量的类型，即指针变量所存储变量地址的那个变量的类型。
    */
    ```
  
    - 定义变量时，指针变量前的 "*" 是一个标志，表示该变量的类型是指针型变量。
    - 指针变量存放某一类型变量的地址，而指针常量是所引用的对象的地址不能改变的指针。
  
  - 初始化和赋值
  
    - 用指针来表示一个变量指向另一个变量的指向关系。
  
    - 使一个指针变量指向一个普通类型的变量：将需要指向的变量的地址赋给对相应的指针变量。
  
    - 指针变量必须被赋值语句初始化后才能使用，否则，直接使用会带来内存错误。指针可被初始化为0、NULL或某个地址。**值为NULL的指针不指向任何值，NULL是在头文件 <stdio.h> （及其他几个头文件）中定义的符号常量。 把一个指针初始化为0，等价于把它初始化为 NULL。**
  
      ```c
      // 指针变量 p 指向变量a
      int * p;
      int a = 3;
      p = &a
      // 等价于：
      int a = 3;
      int * p = &a;
      ```
  
  - 运算
  
    - 指针运算符：
  
      - 取地址运算符 &：取变量的地址。单目运算符，结合性为从右至左。
      - 取内容运算符 *：用来表示指针变量所指的变量。间接引用运算符，结合性为从右至左。**"\*" 运算符后跟的变量必须是指针变量**
  
    - 指针变量的算术操作：加法、减法。
  
      ```c
      int n, *p;
      /*
      *	p 所指的数据存储单元之后的第 n 个数据存储单元，
      *	而不是简单地在指针变量 p 的值上直接加数值。
      *	其中数据存储单元的大小与数据类型有关
      */
      p + n;	// n >= 0
      
      /*
      *	若指针变量 p1 是整型的指针变量，其初始值为 2000, 整型的长度是 2 字节。
      *	则表达式 "p1++" ：p1的值变成 2002，而不是 2001。
      *	每次增量之后，p1都会指向下一个单元。
      *	同理，当 p1 的值为 2000 时，表达式 "p1--" 将 p1 的值变成 1998
      */
      ```
  
    - 指针值的比较
  
- 指针变量作为函数的参数
  
  - 背景：
  
    - 函数的参数可以是整型、实型、字符型和指针类型。当函数的参数是指针类型时，其作用：将一个变量的地址传到另一个函数中。
    - C 中，函数参数的传递是单向值传递。数值只能从调用函数向被调用函数传递，反之不行。形参的改变不会影响实参的改变。
  
  - 问题的提出：用一个被调函数实现主调函数中变量值的改变？
  
    ```c
    /*
    *   试图交换变量值的程序
    *
    *   样例输出：before calling: i = 133, j = 58
    *            in the function swap: a = 58 b = 133
    *            after calling: i = 133, j = 5
    */
    #include <stdio.h>
    
    void swap(int a, int b)
    {
        int temp;
        temp = a;
        a = b;
        b = temp;
        printf("in the function swap: a = %d b = %d\n", a, b);
    }
    
    int main(void)
    {
        int i = 133;
        int j = 58;
    
        printf("before calling: i = %d, j = %d\n", i, j);
        swap(i, j);
        printf("after calling: i = %d, j = %d\n", i, j);
    
        return 0;
    }
    ```
  
  - 解决方法：用指针作为函数参数，传给 swap() 函数的应是想交换的两个变量的地址，而地址可用指针来实现。
  
    - 调用函数时，要注意参数的类型，若是指针，务必传地址。
    - 不能通过改变指针形参的值来改变指针实参的值。
  
    ```c
    /*
    *   使用指针参数将改变带回到调用函数
    *
    *   样例输出：before calling: i = 133, j = 58
    *            in the function swap: *a = 58 *b = 133
    *            after calling: i = 58, j = 133
    */
    #include <stdio.h>
    
    void swap(int *a, int *b)
    {
        int temp;
        temp = *a;
        *a = *b;
        *b = temp;
        printf("in the function swap: *a = %d *b = %d\n", *a, *b);
    }
    
    int main(void)
    {
        int i = 133;
        int j = 58;
    
        printf("before calling: i = %d, j = %d\n", i, j);
        swap(&i, &j);
        printf("after calling: i = %d, j = %d\n", i, j);
    
        return 0;
    }
    
    ```
  
  - 实例
  

## 指针变量的应用

- 指向一维数组的指针变量
  
  - 一维数组指针的概念
    - 数组的指针（**数组名**）：数组在内存中的起始位置，
    - 数组元素的指针：数组元素在内存中的起始地址。
  
  - 一维数组指针的表示方法
  
  - 一维数组元素的引用方法
    - 下标法：用`a[i]`的形式访问数组元素。（比较直观）
    - 指针法：用`*(a + i)`或`*(p + i)`的形式，用间接访问的方法来访问数组元素。其中，a是数组名，p是指向数组 a 的指针变量。（速度较快）
  
  - 通过指针引用数组元素：若 p 为指向某一数组的指针变量，则 p + 1 指向同一数组中的下一个元素
  
    ```c
    int array[10];
    *pointer = array;
    /*
    *	pointer + i 和 array + i 都是数组元素 array[i] 的地址
    *	*(pointer + i)和*(array + i)就是数组元素 array[i]
    *	指向数组的指针变量被赋值为数组名后也可按下标法来使用。（array[i] 等价于 *(pointer + i)） 
    */
    ```
  
    - 数组名是指针变量，始终指向数组的首地址；指针是一个变量，可以实现本身值的改变。
  
    - *(p++) 与 *(++p) 的区别：
  
      ```c
      /*
      *	若 p 的初值为 a，则 *(p++)的值等价于a[0]、*(++p)等价于a[1]，(*p)++表示 p 所指向的元素值加 1
      *	若 p 当前指向 数组a 的第 i 个元素，则有 "*(p--);" 等价于 "a[i--];"、"*(++)p;" 等价于 "a[++i];"、"*(--p)" 等价于 "a[--i];"
      */
      ```
  
- 指向字符串的指针变量

  - 实际上，字符串时内存中一段连续的字节单元中存储的字符的总和，最后用 '\0' 作为结束标志。字符串的指针，其类型是 `char *`或`unsigned char *`

    ```c
    /*
    	C 语言程序允许使用两种方法实现一个字符串的引用
    	i 是一个整数下标，则 s[i] 与 *(s + i) 是同一个元素，&s[i] 与 s + i 是同一个地址。
    */
    ```

  - 利用字符指针处理字符串

  - 字符数组和字符指针都能处理字符串，区别在于：

    - 字符数组由若干元素组成，每个元素中放一个字符，若用来处理字符串，必须保证有串结束符。字符指针变量用来存放字符串的首地址（若未初始化，它指向的地址是不确定的。）
    - 赋值方式：字符数组只能对各个元素赋值，不能整体赋值。
    - 在说明一个字符数组后，其地址是确定的。说明一个字符指针变量时，指针变量的值可以改变。

- 应用

## 常见错误

- 对指针变量赋予非指针值

  ```c
  #include <stdio.h>
  
  int main(void)
  {
      int i = 10;
      int *p;
      /*
      *	编译提示给指针变量赋值时用了整型数值。i 是整型变量，而 p 是指向整型变量的指针变量，它们的类型不同。
      *	p 所要求的是一个指针值，即一个变量的地址。因此，应该写为 "p = &i"
      */
      p = i;		
      printf("%d\n", p);
      
      return 0;
  }
  ```

- 指针未能指向确定的存储区

  ```c
  #include <stdio.h>
  
  int main(void)
  {
      char *str;
      scanf("%s", str);	// 企图从键盘输入一个字符串，使 str 指向该字符串
      printf("%s", str);
      
      return 0;
  }
  
  /*
  *	严重性		代码			说明	
  *	错误		C4700		  使用了未初始化的局部变量“str”
  */
  ```

- 混淆数组名与指针变量

  ```c
  #include <stdio.h>
  
  int main(void)
  {
      int i, a[5];
      for(i = 0; i < 5; i++)
          /*
          *	企图通过改变 a 的值使指针下移，每次指向下一个数组元素。
          *	但 a 是数组名，是数组的首地址，是常量，它的值是不能改变的。
          *	a++ 是错误的，应当用指针变量来指向各数组元素。
          */
          scanf("%d", a++);
      return 0;
  }
  ```

- 不同数据类型的指针混用

```c
#include <stdio.h>

int main(void)
{
    int a = 5, *p;
    float b = 3.5, *q;
    p = &a;
    q = &b;
    q = p;		// 企图使 q 指向整型变量 a，但 q 是指向 float 型变量的指针，不能指向整型变量
    printf("%d, %d\n", *p, *q);
    
    return 0;
}
```

